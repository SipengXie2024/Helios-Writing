\begin{algorithm}[t]
\small
\caption{Online Mode: Path Lookup}
\label{alg:online-lookup}

\textbf{Notation:} $\mathcal{S}_{\sigma}$ denotes a PathStore for CallSig $\sigma$, maintaining $M_{freq}$ (PathDigest $\to$ frequency map) and $I_{sorted}$ (frequency $\to$ PathDigest set, sorted index).

\KwIn{$\sigma$: CallSig (code hash $\|$ function selector)}
\KwIn{$h_c$: Contract code hash for DataKey construction}
\KwIn{$\mathcal{P}$: Path Cache with PML and GML layers}
\KwOut{$(G, C, \ell)$: Cached graph, constant table, and PathDigest; or $\bot$ if prediction fails}

\tcp{Phase 1: Query Path Mapping Layer for hot path}
\If{$\sigma \notin \mathcal{P}.PML$}{
    \Return{$\bot$} \tcp*{Cold start: CallSig never observed}
}

$\mathcal{S}_{\sigma} \gets \mathcal{P}.PML[\sigma]$ \tcp*{Retrieve PathStore}
\textsc{AcquireReadLock}($\mathcal{S}_{\sigma}$) \\

\tcp{Get unambiguous maximum frequency path}
$(f_{max}, P_{max}) \gets I_{sorted}.\textsc{LastEntry}()$

\If{$|P_{max}| \neq 1$}{
    \textsc{ReleaseReadLock}($\mathcal{S}_{\sigma}$) \\
    \Return{$\bot$} \tcp*{Ambiguous: multiple paths share max frequency}
}

$\ell \gets P_{max}.\textsc{First}()$ \tcp*{Extract the unique hot path}
\textsc{ReleaseReadLock}($\mathcal{S}_{\sigma}$) \\

\tcp{Phase 2: Query Graph Mapping Layer for artifacts}
\If{$\ell \notin \mathcal{P}.GML.graphs$}{
    \Return{$\bot$} \tcp*{Path not yet optimized}
}

$k_{data} \gets h_c \| \ell$ \tcp*{Construct DataKey}

\If{$k_{data} \notin \mathcal{P}.GML.data$}{
    \Return{$\bot$} \tcp*{Constant table missing}
}

$G \gets \mathcal{P}.GML.graphs[\ell]$ \\
$C \gets \mathcal{P}.GML.data[k_{data}]$ \\

\Return{$(G, C, \ell)$} \tcp*{Successful prediction}

\end{algorithm}
